function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(n,!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Image=function(){function t(e){_classCallCheck(this,t),this.containerWidth=e.rectDimension||0,this.width=this.containerWidth/t.SCALE_FACTOR,this.left=e.left||0,this.top=e.top||0,this.imageObject=new fabric.Path(t.PATH),this.imageObject.set({left:this.left,top:this.top}),this.imageObject.scaleToWidth(this.width),this.imageObject.scaleToHeight(this.width),this.imageObject.selection=!1,this.imageObject.hasBorders=!1,this.imageObject.hasControls=!1,this.imageObject.hoverCursor="default",this.toggleImageVisibillity(!1),this.attachListeners()}return _createClass(t,[{key:"toggleImageVisibillity",value:function(e){this.imageObject.opacity=e?1:0}},{key:"setImagePosition",value:function(e){var t=e.column*this.containerWidth+(this.containerWidth-this.width)/2,n=e.row*this.containerWidth+(this.containerWidth-this.width)/2;this.toggleImageVisibillity(!0),this.imageObject.set({left:t,top:n})}},{key:"attachListeners",value:function(){}}]),t}();Image.SCALE_FACTOR=2.5,Image.PATH="M256 224c-79.41 0-192 122.76-192 200.25 0 34.9 26.81 55.75 71.74 55.75 48.84 0 81.09-25.08 120.26-25.08 39.51 0 71.85 25.08 120.26 25.08 44.93 0 71.74-20.85 71.74-55.75C448 346.76 335.41 224 256 224zm-147.28-12.61c-10.4-34.65-42.44-57.09-71.56-50.13-29.12 6.96-44.29 40.69-33.89 75.34 10.4 34.65 42.44 57.09 71.56 50.13 29.12-6.96 44.29-40.69 33.89-75.34zm84.72-20.78c30.94-8.14 46.42-49.94 34.58-93.36s-46.52-72.01-77.46-63.87-46.42 49.94-34.58 93.36c11.84 43.42 46.53 72.02 77.46 63.87zm281.39-29.34c-29.12-6.96-61.15 15.48-71.56 50.13-10.4 34.65 4.77 68.38 33.89 75.34 29.12 6.96 61.15-15.48 71.56-50.13 10.4-34.65-4.77-68.38-33.89-75.34zm-156.27 29.34c30.94 8.14 65.62-20.45 77.46-63.87 11.84-43.42-3.64-85.21-34.58-93.36s-65.62 20.45-77.46 63.87c-11.84 43.42 3.64 85.22 34.58 93.36z";var Canvas=function(){function t(e){_classCallCheck(this,t),this.id=e.id,this.className="my_canvas",this.canvas=null,this.init(e),this.create(e),this.createImage(e)}return _createClass(t,[{key:"init",value:function(e){var t=document.createElement("canvas");t.id=e.id,document.getElementById("app").appendChild(t)}},{key:"create",value:function(e){this.canvas=new fabric.Canvas(e.id,{containerClass:this.className}),this.canvas.setHeight(e.height+1),this.canvas.setWidth(e.width+1)}},{key:"destroy",value:function(){var e=document.getElementsByClassName(this.className);e&&e[0].remove(),this.canvas&&this.canvas.dispose()}},{key:"add",value:function(e){this.canvas.add(e)}},{key:"insertAt",value:function(e,t){this.canvas.insertAt(e,t,!1)}},{key:"createImage",value:function(e){this.image=new Image(e),this.canvas.insertAt(this.image.imageObject,0)}}]),t}(),Rectangle=function(){function i(e){_classCallCheck(this,i),this.rect=null,this.dimension=e.dimension||50,this.column=e.column,this.row=e.row,this.clicked=e.clicked,this.mouseOver=e.mouseOver,this.mouseOut=e.mouseOut,this.isPermanent=!1,this.isTemporary=!0,this.create(e),this.attachSelectedListener()}return _createClass(i,[{key:"create",value:function(e){var t=this.column*this.dimension,n=this.row*this.dimension;this.rect=new fabric.Rect({id:"".concat(this.column,"_").concat(this.row),left:t,top:n,fill:i.COLORS.REGULAR,width:this.dimension,height:this.dimension,stroke:i.COLORS.BORDER,strokeWidth:e.strokeWidth||1,lockMovementX:!0,lockMovementY:!0,selection:!1,hasBorders:!1,hasControls:!1,hoverCursor:"default"})}},{key:"get",value:function(){return this.rect}},{key:"attachSelectedListener",value:function(){var e=this;this.rect.on("selected",function(){return e.clicked(e)})}},{key:"deattachSelectedListener",value:function(){this.rect.__eventListeners.selected=[]}},{key:"attachMouseOverListener",value:function(){var e=this;this.rect.on("mouseover",function(){return e.mouseOver(e)})}},{key:"deatachMouseOverListener",value:function(){this.rect.__eventListeners.mouseover=[]}},{key:"attachMouseOutListener",value:function(){var e=this;this.rect.on("mouseout",function(){return e.mouseOut(e)})}},{key:"deatachMouseOutListener",value:function(){this.rect.__eventListeners.mouseout=[]}},{key:"setIsPermanent",value:function(e){this.isPermanent=e,this.deattachSelectedListener(),this.fillRectangle(i.COLORS.PERMANENT)}},{key:"setIsTemporary",value:function(e){this.isTemporary=e,this.fillRectangle(e?i.COLORS.TEMPORARY:i.COLORS.REGULAR),e?(this.attachMouseOverListener(),this.attachMouseOutListener(),this.rect.hoverCursor="pointer"):(this.rect.hoverCursor="default",this.deatachMouseOverListener(),this.deatachMouseOutListener())}},{key:"fillRectangle",value:function(e){var t=0<arguments.length&&void 0!==e?e:i.COLORS.DEFAULT;this.rect.set("fill",t)}}]),i}();Rectangle.COLORS={BORDER:"gray",REGULAR:"white",PERMANENT:"rgb(144, 140, 255)",TEMPORARY:"rgb(195, 186, 255)",HOVER:"rgb(195, 186, 0)"};var Game=function(){function t(e){var o=this;_classCallCheck(this,t),_defineProperty(this,"rectangleClickedHandler",function(e){e.isTemporary&&(o.resetTemporaryRectangles(),o.setPermanentRectangle(e),o.setTemporaryRectangles(e)),e.rect.canvas.setActiveObject(e.rect.canvas._objects[0])}),_defineProperty(this,"setPermanentRectangle",function(e){o.state.permanent.push(e),e.setIsPermanent(!0),o.layout.image.setImagePosition({column:e.column,row:e.row})}),_defineProperty(this,"setTemporaryRectangles",function(e){var t=Object.keys(o.pattern);for(var n in t){var i=o.pattern[t[n]],s=e.column-i.column,r=e.row-i.row;if(0<=s&&s<o.width&&0<=r&&r<o.height){var a=o.rectangles[s][r];a.isPermanent||(a.setIsTemporary(!0),o.state.temporary.push(a))}}o.checkScore()}),_defineProperty(this,"resetTemporaryRectangles",function(){o.state.temporary=[],o.rectangles.map(function(e){e.map(function(e){e.isPermanent||e.setIsTemporary(!1)})})}),_defineProperty(this,"rectangleMouseOverHandler",function(e){e.get().set("fill",Rectangle.COLORS.HOVER),e.get().canvas.renderAll()}),_defineProperty(this,"rectangleMouseOutHandler",function(e){e.get().set("fill",Rectangle.COLORS.TEMPORARY),e.get().canvas.renderAll()}),this.state={history:[],permanent:[],temporary:[]},this.rectangles=null,this.pattern=e.pattern&&t.CAT_PATTERN[e.pattern]||t.CAT_PATTERN.PATTERN_2,this.rectDimension=e.rectDimension||null,this.rectStrokeWidth=e.rectStrokeWidth||null,this.width=e&&e.width&&e.width||10,this.height=e&&e.height&&e.height||10,this.initCanvas(e),this.initRectangles(),this.createRectangles(e),this.setScore(0)}return _createClass(t,[{key:"exit",value:function(){this.layout&&this.layout.destroy()}},{key:"initCanvas",value:function(e){this.layout=new Canvas({id:e.id,rectDimension:e.rectDimension,width:e.rectDimension*this.width+this.rectStrokeWidth,height:e.rectDimension*this.height+this.rectStrokeWidth})}},{key:"initRectangles",value:function(){this.rectangles=new Array(this.width);for(var e=0;e<this.width;e++)this.rectangles[e]=new Array(this.height);console.log(this.rectangles)}},{key:"createRectangles",value:function(e){for(var t=0;t<this.width;t++)for(var n=0;n<this.height;n++){var i=this.getRectangle(_objectSpread2({},e,{column:t,row:n}));this.rectangles[t][n]=i,this.layout.add(i.get())}}},{key:"getRectangle",value:function(e){return new Rectangle({column:e.column,row:e.row,dimension:this.rectDimension,strokeWidth:this.rectStrokeWidth,clicked:this.rectangleClickedHandler,mouseOver:this.rectangleMouseOverHandler,mouseOut:this.rectangleMouseOutHandler})}},{key:"checkScore",value:function(){0===this.state.temporary.length&&alert("Mjau mrnjau :("),this.state.permanent.length===this.width*this.height&&alert("Mjau mrnjau :)"),this.setScore(this.state.permanent.length)}},{key:"setScore",value:function(e){document.getElementById("score").innerHTML=" SCORE: ".concat(e," / ").concat(this.width*this.height)}}]),t}();Game.CAT_PATTERN={PATTERN_1:{stage_1:{column:0,row:2},stage_2:{column:1,row:1},stage_3:{column:2,row:0},stage_4:{column:1,row:-1},stage_5:{column:0,row:-2},stage_6:{column:-1,row:-1},stage_7:{column:-2,row:0},stage_8:{column:-1,row:1}},PATTERN_2:{stage_1:{column:0,row:3},stage_2:{column:2,row:2},stage_3:{column:3,row:0},stage_4:{column:2,row:-2},stage_5:{column:0,row:-3},stage_6:{column:-2,row:-2},stage_7:{column:-3,row:0},stage_8:{column:-2,row:2}},PATTERN_3:{stage_1:{column:0,row:4},stage_2:{column:3,row:3},stage_3:{column:4,row:0},stage_4:{column:3,row:-3},stage_5:{column:0,row:-4},stage_6:{column:-3,row:-3},stage_7:{column:-4,row:0},stage_8:{column:-3,row:3}}};var app=function(){var t=10,n=10,i=50,s=null,r=null;return{init:function(){document.addEventListener("DOMContentLoaded",function(){document.getElementById("input_columns").setAttribute("max",50),document.getElementById("input_rows").setAttribute("max",50),document.getElementById("input_cell_width").setAttribute("max",100)}),document.getElementById("input_columns").addEventListener("change",function(){t=50<(t=(t=parseInt(this.value,10))<10?10:t)?50:t}),document.getElementById("input_rows").addEventListener("change",function(){n=50<(n=(n=parseInt(this.value,10))<10?10:n)?50:n}),document.getElementById("input_cell_width").addEventListener("change",function(){i=100<(i=(i=parseInt(this.value,10))<20?20:i)?100:i}),document.getElementById("input_pattern").addEventListener("change",function(){s=this.value});var e=this;return document.getElementById("play_game").addEventListener("click",function(){e.play({width:t,height:n,rectDimension:i,pattern:s})}),this},play:function(e){r&&r.exit(),r=new Game({id:"fat_cat",rectStrokeWidth:1,rectDimension:e&&e.rectDimension||i,width:e&&e.width||t,height:e&&e.height||n,pattern:e&&e.pattern})}}}();app.init().play();
